<!DOCTYPE HTML>

<html>
	
<head>
<title>Tutorial Model Free Analysis</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<link rel="stylesheet" href="../assets/css/main.css" />
<noscript><link rel="stylesheet" href="../assets/css/noscript.css" /></noscript>
</head>

<body class="is-preload">

<div id="wrapper">

<div id="main">

<div class="inner">

<h4><a href="../index.html">Home</a></h4>
<h1>Tutorial: Model Free Analysis</h1>
<p> Tutorial contributors: Andreas Haahr Larsen.</p>

<h4>Before you start</h4>
	<ul>
	<li>Python or similar for importing and plotting data (including numpy, scipy and matplotlib).</li>
	</ul>
	
<h4>Learning outcomes</h4>
Overall learning outcome is to be able to retrieve strucutural information from a SAXS or SANS dataset before doing more detailed modelling, e.g. with form factors. Subgoals include:
	<ul>
	<li>Learn to do a Guinier analysis and retrieve the radius of gyration.</li>
	<li>Be able to create a Porod plot and understand its interpretation.</li>
	<li>Use Kratky plot to assess the whether a particle is compact/well-folded or disordered/unfolded.</li>
	<!--<li>For protein, estimate the oligomeric state by determining the molecular weight, M<sub></sub></li>-->
	<li>Do an indirect Fourier transformation and retrieve structural parameters, R<sub>g</sub> and d<sub>max</sub>.</li>
	<li>Estimate particle shape using the pair distance distribution (obtained via indirect Fourier transformation).</li>
	<li>Be familiar with ab initio modelling, including possibilities and limitations.</li>
	</ul>

<h4>Challenges</h4>
If you can solve these challenges, you have (probably) learned the above. <br>
By following the tutorials below the challenges (Part 1-5), you will acquire skills and knowledge that can be applied to solve the challenges. 
<ul>
	<li>Challenge 1: You have measured a sample of RNase A in D<sub>2</sub>O with SANS (<a href="RNAseA.dat" target="_blank">download SANS data</a>). What is the overall size and shape of this protein?</li>
	<li>Challenge 2: You have measured the <a href="https://en.wikipedia.org/wiki/AMPA_receptor" target="_blank"> AMPA receptor</a> (a membrane protein involved in neuronal signalling) D<sub>2</sub>O with SANS contrast variation (to avoid detergent signal, see also the <a href="../ContrastVariation/ContrastVariation.html" target="_blank">Contrast variation tutorial</a>). The protein was measured in the apo state, i.e. without any ligands bound (<a href="GluA2_apo.dat" target="_blank">download SANS data</a>). <br> 
		You would like to find out if the overall size of the solution structure (as measued in SANS) is different from the crystal structure (measured with x-ray crystallography) - is this the case? The theoretical radius of gyration was calculated from the crystal structure to be ca 57 Å. <br>
		You also measured GluA2 in the presense of AMPA, which is an agonist (an activating molecule) for GluA2, (<a href="GluA2_ampa.dat" target="_blank">download SANS data</a>) - does this induce a structural change compared to the apo state? 
	</li>
	<li>Challenge 3: You have measured the microtubule-associated protein 2 (MAP2) in SAXS (<a href="map2.dat" target="_blank">download SAXS data</a>). Is it folded or unfolded under the conditions you measured it?</li>
	<li>Challenge 4: This challenge is also part of the <a href="../Spheres/Spheres.html" target="_blank">Sphere tutorial</a>. But what can you tell without any modelling with form factors? Here comes the challenge: <br> 
		A sample of discoidal particles (i.e. shaped like disc/short cylinders) was measured in SAXS at neutral pH (<a href="../Spheres/SAXS_neutral_pH.dat" target="_blank">download neutral pH data</a>) and pH 5.0 (<a href="../Spheres/SAXS_low_pH.dat" target="_blank">download low pH data</a>). What effect does the pH change have on the particles and their interaction?</li>
	<li>Challenge 5: You have measured a sample of mixture of <a href="https://en.wikipedia.org/wiki/Polysorbate_80" target="_blank">Polysorbate 80</a> and <a href="https://en.wikipedia.org/wiki/Myristic_acid" target="_blank">Myristic acid</a> in SAXS (<a href="Polysorbate80_MA_SAXS.dat" target="_blank">download SAXS data</a>). What can you tell about the stucture these molecules form?</li>
</ul>

<h4>Part 1: Guinier plot and Guinier analysis for R<sub>g</sub> determination</h4>
	<p>
	The <a href="https://bioxtas-raw.readthedocs.io/en/latest/saxs/saxs_guinier.html" target="_blank">Guinier approximation</a> is valid at low values of q. From a Guinier analysis you can derive the (contrast-weighted) radius of gyration, R<sub>g</sub> of the particles. I.e. it gives an idea about the size of the particles. <br>
	Since R<sub>g</sub> also depends on the shape (more extended particles have larger R<sub>g</sub>), it gives a hint about the particle shape as well.<br>
	<img src="Guinier.jpg" style="width:600px"/><br>
	There are tools for automatic Guinier analysis, including <a href="https://www.embl-hamburg.de/biosaxs/manuals/autorg.html" target="_blank">ATSAS autorg</a> and <a href="https://bioxtas-raw.readthedocs.io/en/latest/" target="_blank">bioxtas RAW auto Guinier</a>, but here, you will learn to do it manually:
	<ul>
		<li>Download the SAXS data for the protein <a href="https://www.sasbdb.org/data/SASDMF2/" target="_blank">lysozyme</a> at the small-angle scattering biological data bank (Download files > curve (dat))</li>
		<li>Import and plot the data. Use a log scale for the y-axis. You can use any program for this, but if you use Python, you can use this <a href="plot_lyz.py" target="_blank">python plotting script</a>. </li>
		<li>Generate a Guinier plot, by plotting log(I) vs q<sup>2</sup>. You may use <a href="Guinier_plot_lyz.py" target="_blank">this script</a> </li>
		<li>The Guinier approximation claims that the low-q part of the curve is linear. Determine this region in q (e.g. by zooming in on the plot). The linear region is called the "Guinier region".</li>
		<li>Determine the maximum value of q-squared (q<sup>2</sup>) at which the data is still linear in the Guinier plot. </li>
		<li>The Guinier approximation is I = I(0)exp(-q<sup>2</sup>R<sub>g</sub><sup>2</sup>/3). Or expressed differently: ln(I) = ln(I(0)) - (R<sub>g</sub><sup>2</sup>/3)q<sup>2</sup>. So the forward scatteing, I(0), is determined by the intersection and the radius of gyration, R<sub>g</sub>, by the slope.</li>
		<li>Make a Guinier analysis by (1) fitting a straight line to the curve, (2) determine the slope, (3) determine the intersection with the y-axis, and derive I(0) and R<sub>g</sub>. You may use this <a href="Guinier_analysis_lyz.py" target="_blank">Python script</a> (you need to set the qmax in the scrip).</li>
		<li>As a rule of thumb, the Guinier approximation is valid up to qR<sub>g</sub> = 1.3 for globular particles (i.e. sphere-like particles), and up to qR<sub>g</sub> = 1.0 for elongated particles (e.g., cylinders). Lysozyme is globular. Check your value of qR<sub>g</sub> and adjust qmax accordingly.</li>
		<li>Is this R<sub>g</sub> consistent with the R<sub>g</sub> reported in the <a href="https://www.sasbdb.org/data/SASDMF2/" target="_blank">SASBDB entry</a>? (within +/- 1 Å)</li>
	</ul>
	If the R<sub>g</sub> is larger than the expected, this could be due to various factors, including:
	<ul>
		<li>Aggregation in the sample</li>
		<li>Oligomerization</li>
		<li>Change of shape (more elongated particles have larger R<sub>g</sub>)</li>
	</ul>
	Note that if the sample is too large, compared to the minimum q value, there is no Guinier region (or rather, the Guinier region is at lower values of q than those measured). 
	</p>

<h4>Part 2: Porod Analysis</h4>
	<p>
	The Porod approximation is valid at large values of q. It states that the intensity is proportional to q<sup>-4</sup> at large values of q.<br>
	Using the lysozyme SAXS data again, plot the data as Iq<sup>4</sup> vs q, on a log-log scale. You may use one of the previous scripts as template. <br>
	Try to determine the Porod region for this data - i.e. where is Iq<sup>4</sup> vs q approximately constant (it may fluctuate around a constant value due to noise in data)<br>
	If the slope of the Porod plot at large q values is different from q<sup>-4</sup>, this can be due to surface roughness, and a Porod analysis is an estimate of the surface roughness of a material from the slope in a Porod plot: <br>
		<img src="Porod.png" style="width:600px"/></li>
	The Porod region is also sensitive to background subtraction, as can be seen by adding a constant background to the intensity and doing the Porod plot. Your may use <a href="Porod_plot_lyz.py" target="_blank">this script</a> to see the effect of that. In that script, a background of 1 was added to the intensity.<br>
	This background sensitivity means that the Porod plot is a good tool for determining the correct level of constant background subtraction, which stem from incoherent scattering.
	</p>

<h4>Part 3: Kratky plot</h4>
	<p>
	The Kratky plot (Iq<sup>2</sup> vs q) carries information about the structural flexibility of a particle:<br>
	<img src="Kratky.jpg" style="width:600px"/><br>
	This interpretation assumes that the particle is homogeneous, i.e., the scattering length density is approximately the same throughout the particle. Proteins constitute an important class of particles where the scattering length is quite constant, so Kratky plots are valuble for model-free protein structure determination. Micelles of detergents og block copolymers, on the other hand, are an examples of a particles that are not homogeneous.<br>
	Make a Kratky plot for the SAXS lysozyme data. You may use <a href="Kratky_plot_lyz.py" target="_blank">this script</a>, but you need to set the background level (begin with background = 0).<br>
	Note that a Porod plot (see above) may be a good help to determine the correct background level.<br>
	Lysozyme measured under these conditions is (predominantly) folded - you can see that from the Kratky plot by comparing with idealized Kratky plots. 
	</p>

<h4>Part 4: Indirect Fourier Transformation</h4>
    <p>
		As the coherent scattering can be calculated by a Fourier transformation of the particle, then an inverse Fourier transformation of the data should give back the structure. Unfortunately this is not the case for small-angle scattering, because:
		<ul>
			<li>Structural information is lost due to random orientation of the sample</li>
			<li>Phase information is also lost (<a href="https://en.wikipedia.org/wiki/Phase_problem" target="_blank">the phase problem</a>). The wave amplitude is measured by the detector, but the phase is not.</li>
			<li>There is noise in data.</li>
			<li>The data is measured in a finite range (between q<sub>min</sub> and q<sub>max</sub>), whereas a Fourier tranformation requires data from minus infinity to plus infinity.</li>
		</ul>
		However, by doing an <a href="https://en.wikipedia.org/wiki/Indirect_Fourier_transformation" target="_blank">indirect Fourier transformation</a>, you can get a 1D representation of the particle.<br>
		This representation is called the pair distance distribution and is written p(r). It is informally called the "p-of-r-function". For a homogeneous particle, it is simply a histogram of how many pairs of scatterers that have a specific distance, r, between them. This pair distance distribution is characteristic for specific shapes:<br>
		<img src="pr.png" style="width:800px"/><br>
		Thus, without any modelling, you may can get an idea of the structure of your particle of interest.<br>
		Go to <a href="https://somo.chem.utk.edu/shape2sas/" target="_blank">Shape2SAS</a> and press the green "Submit" button with the default values. Then you will see the p(r) for a 50 Å sphere, along with the scattering calculated. A couple of observations<br>
		<ul> 
			<li>The pair distribution is symmetric, as a sphere is symmetric in all directions.</li>
			<li>p(r) starts in zero and goes to zero at some value of r. The latter is the maximum distance between any pair in the particle and is denoted d<sub>max</sub>. For a sphere, d<sub>max</sub> equals the diameter.</li>
			<li>The most common distance between pairs of scatterers in a sphere is equal to the radius.</li>
		</ul>
		If you Fourier transform p(r), you get the scattering. This is what the program <a href="https://somo.chem.utk.edu/shape2sas/" target="_blank">Shape2SAS</a> does. It first calculates p(r) and from that, the scattering.<br>
		To see and compare the p(r) from various paticles, go back to <a href="https://somo.chem.utk.edu/shape2sas/" target="_blank">Shape2SAS</a> and click the box "Calculate scattering for Model 2" to choose another shape or size as Model 2 (e.g. a cylinder, or a larger sphere). Press "Submit" <br>
	</p>
	<p>
		If the particle is not homogeneous (the contrast is not approximately the same in the whole particle), then the p(r) is harder to interpret.<br>
		This is because the p(r) is a distribution weighted with the product of the scattering lengths for scattering pairs, or rather the excess scattering length (contrast). This number can be negative. So the contribution from a scattering pair may be negetive if one has negative and one has positive contrast. 
		This will often lead to bumps or oscillations in the p(r). In <a href="https://somo.chem.utk.edu/shape2sas/" target="_blank">Shape2SAS</a>, simulate a spherical core-shell particle with negative core contrast (&Delta;SLD=-1) and and positive shell contrast (&Delta;SLD=1)<br>
		<img src="Shape2SAS_CoreShell.png" style="width:800px"/><br>
		In this case, you may get both positive and negative parts in the p(r). The negative parts come if, at a given distance, there are most pairs having contrasts with opposing signs (i.e. one has positive and one has negative constrast.)
	</p>
	<p>
		There are multiple programs for indirect Fourier transformation of SAXS and SANS data. One is <a href="https://somo.chem.utk.edu/bayesapp/" target="_blank">BayesApp</a> (it uses a Bayesian refinement method, hence the name).<br>
		Note that BayesApp can also do Guinier plots, Porod plots, and Kratky plots if opted for. 
		Try to do an indirect Fourier tranformation of the <a href="SASDMF2.dat" target="_blank">lysozome data</a> using <a href="https://somo.chem.utk.edu/bayesapp/" target="_blank">BayesApp</a>. You may give an estimate of the d<sub>max</sub> (ca 50 Å) to help the algorithm find a solution faster. <br>
		By comparing with the p(r) from a sphere, you can see that lysozyme is globuler (i.e., spherical-ish). </p>
		The radius of gyration can also be found from the p(r), as R<sub>g</sub> is, by definition, given as:<br>
		<img src="Rg_pr.png" style="width:120px"/><br>
		A good quality check of data is to compare the R<sub>g</sub> obtained via the p(r) with that obtainedb by Guinier analysis.
	</p>
	<p> For non-homogeneous particles, you may get negative contributions to p(r). In that case, it is necessary to allow BayesApp to use negative values for p(r):
		<ul>
			<li>To see the effect of NOT doing this, try to run <a href="https://somo.chem.utk.edu/bayesapp/" target="_blank">BayesApp</a> on the simulated micelle data which had negative contrast in the core. I.e. the data you simulated using <a href="https://somo.chem.utk.edu/shape2sas/" target="_blank">Shape2SAS</a> (<a href="core_shell_negative_positive.dat">or download this simulated dataset</a>). You may help the algoritm by providing an approximative value for the maximum distance.</li>
			<li>You will notice that the p(r) does not look like the one you got in Shape2SAS.</li>
			<li>Now, allow BayesApp to use negative values in p(r) by setting Transformation/Regularization to "Negative", and rerun.</li>
		</ul>
	</p>

<h4>Part 5: Ab initio modelling</h4>
	<p>
		If you know your measured particles are identical and homogeneous, then there are algorithms, that can estimate the 3D shape of you particle. The most commonly used is <a href="https://www.embl-hamburg.de/biosaxs/dammif.html" target="_blank">DAMMIF</a>. <br>
		DAMMIF (and similar bead models) moves around dummy atoms and calculates the scattering from these, using the Debye equation, until the calculated scattering matches the experimental scattering <br>
		<img src="dammif.png" style="width:400px"/><br>
		Note that "s" on the x-axis is the same as q.  
		There are thousands of bead models that equally well fits with the data (i.e., it is an <a href="https://en.wikipedia.org/wiki/Well-posed_problem" target="_blank">ill-posed</a>). Therefore, the algorithm apply constraints, e.g., that the 3D model should be compact (see a description in the <a href="https://doi.org/10.1107/S0021889809000338" target="_blank">DAMMIF paper</a>). Moreover, the algorithm is typically run multiple times and the refined structure is then an average of the possible solutions.<br>
		Even with these constraints, the resulting structures should be interpreted with care due to the highly ill-posed nature of the problem. That said, ab initio modelling is very useful and widely applied, especially for protein structure determination..<br>
		<ul>You can try to do ab initio modelling of the lysozome data by following these steps
			<li>Go to the <a href="https://www.embl-hamburg.de/biosaxs/atsas-online/login.php?location=dammif.phponline" target="_blank"> online version of DAMMIF</a>, which is part of the ATSAS software.</li>
			<li>Make a user and sign in.</li>
			<li>The program asks for a "GNOM file". GNOM is a program like BayesApp, that calculates the p(r). GNOM is also part of the ATSAS package. You can use <a href="SASDMF2.out" target="_blank">this GNOM file</a>. </li>
			<li>Use these settings: Angular units (of q): 1/Å; Symmetry: P1 (no symmetry); Anisometry: Unknown; Mode: Fast: Run DAMMIF 3 times.</li>
			<li>Press SUBMIT</li>
			<li>You are notified by email when your result is ready (probably after 5 min)</li>
		</ul>
		Does the result (qualitatively) compare with the lysozyme structure (try to google "lysozyme PDB" or scroll down <a href="https://www.uniprot.org/uniprotkb/P61626/entry" target="_blank">the UniProtID page for lysozyme</a> to find a 3D structure to compare with). <br>
		The obtained 3D structure could be refined by running more instances, taking the average of these and run in the slow mode.<br>
		Note that this ab initio modelling assumes particles with homogeneous contrast. There are, however, ab initio algorithms that allow multiple contrasts, e.g. <a href="https://denss.ccr.buffalo.edu/" target="_blank">DENSS</a>. However, this makes the problem even more <a href="https://en.wikipedia.org/wiki/Well-posed_problem" target="_blank">ill-posed</a>, i.e., more possible solutions can fit the data. So the structures should be interpreted with care.
	</p>

<h4>Feedback</h4>
	<p>By filling this <a href="https://forms.gle/cxCDumAUq21RbjxS8" target="_blank">feedback form</a> you can help us improve the tutorials (it takes 2 min).</p>

<h4><a href="../index.html">Home</a></h4>

<!-- end inner -->
</div>
	
<!-- end main -->
</div>

<!-- end wrapper -->
</div>
	
<!-- Scripts -->
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/browser.min.js"></script>
<script src="../assets/js/breakpoints.min.js"></script>
<script src="../assets/js/util.js"></script>
<script src="../assets/js/main.js"></script>
</body>	
</html>
